
    <div class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__links">
                        <a href="./index.html"><i class="fa fa-home"></i> Home</a>
                        <span>Shopping cart</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Breadcrumb End -->

    <!-- Shop Cart Section Begin -->
    <section class="shop-cart spad">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="shop__cart__table">
          <table>
            <thead>
              <tr>
                <th>Product</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Total</th>
                <th></th>
              </tr>
            </thead>

           <tbody>
  <% if @line_items.any? %>
    <% @line_items.each do |item| %>
      <tr>
        <td class="cart__product__item">
          <div class="cart__product__item__image">
            <% if item.product_variant_combination.product.featured_image.attached? %>
              <%= image_tag item.product_variant_combination.product.featured_image, width: 100 %>
            <% else %>
              <%= image_tag "default-product.jpeg", width: 100 %>
            <% end %>
          </div>

          <div class="cart__product__item__title">
            <h6><%= item.product_variant_combination.product.name %></h6>
            (<%= item.product_variant_combination.product_variants.map(&:value).join(" / ") %>)
          </div>
        </td>

        <td class="cart__price">
          <%= number_to_currency(item.product_variant_combination.price) %>
        </td>

        <td class="cart__quantity">
          <%= form_with model: item, url: line_item_path(item), method: :patch, local: true do |f| %>
            <%= f.number_field :quantity, min: 1, value: item.quantity %>
            <%= f.submit "Update", class: "btn btn-sm btn-primary" %>
          <% end %>
        </td>

        <td class="cart__total">
          <%= number_to_currency(item.quantity * item.product_variant_combination.price) %>
        </td>

        <td>
          <%= button_to "Remove",
                line_item_path(item),
                method: :delete,
                class: "btn btn-danger btn-sm",
                data: { confirm: "Remove this item?" } %>
        </td>
      </tr>
    <% end %>
  <% else %>
    <tr>
      <td colspan="5" class="text-center">Your cart is empty</td>
    </tr>
  <% end %>
</tbody>

          </table>
        </div>
      </div>
    </div>

    <!-- Buttons -->
    <div class="row">
      <div class="col-lg-6">
        <div class="cart__btn">
          <%= link_to "Continue Shopping", root_path %>
        </div>
      </div>
    </div>

    <!-- Cart Total -->
    <div class="row">
      <div class="col-lg-4 offset-lg-8">
        <div class="cart__total__procced">
          <h6 style="border-bottom: 1px solid black;">Your Cart total</h6>
          <ul>
            <li>
              Subtotal
              <span id="cart-subtotal"><%= number_to_currency(@cart.total_amount) %></span>
            </li>
            <li>
              Total
              <span id="cart-total"><%= number_to_currency(@cart.total_amount) %></span>
            </li>
          </ul>
<% if @line_items.any? %>
    <%= link_to "Select the Address", billing_details_path, class: "primary-btn" %>
  <% else %>
    <button class="primary-btn" disabled>Cart is Empty</button>
  <% end %>
          
        </div>
      </div>
    </div>
  </div>
</section>



<script>
document.addEventListener("DOMContentLoaded", () => {
  // Handle quantity changes
  document.querySelectorAll(".quantity-input").forEach(input => {
    input.addEventListener("change", updateQuantity)
  });

  // Handle remove buttons
  document.querySelectorAll(".remove-cart-btn").forEach(btn => {
    btn.addEventListener("click", removeItem)
  });

  function updateQuantity(event) {
    const input = event.target;
    const tr = input.closest("tr");
    const lineItemId = tr.dataset.lineItemId;
    const quantity = parseInt(input.value);

    fetch(`/line_items/${lineItemId}`, {
      method: "PATCH",
      headers: {
        "Content-Type": "application/json",
        "X-CSRF-Token": document.querySelector('meta[name="csrf-token"]').content
      },
      body: JSON.stringify({ line_item: { quantity: quantity } })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        // Update row total
        tr.querySelector("[data-cart-target='lineTotal']").innerText = data.line_item_total;
        // Update cart totals
        document.getElementById("cart-subtotal").innerText = data.cart_subtotal;
        document.getElementById("cart-total").innerText = data.cart_total;
      }
    })
    .catch(err => console.error("Error updating quantity:", err));
  }

  function removeItem(event) {
    const btn = event.target;
    const tr = btn.closest("tr");
    const lineItemId = tr.dataset.lineItemId;

    fetch(`/line_items/${lineItemId}`, {
      method: "DELETE",
      headers: {
        "X-CSRF-Token": document.querySelector('meta[name="csrf-token"]').content
      }
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        // Remove the row from table
        tr.remove();
        // Update cart totals
        document.getElementById("cart-subtotal").innerText = data.cart_subtotal;
        document.getElementById("cart-total").innerText = data.cart_total;

        // If cart is empty, show empty message
        if (data.cart_empty) {
          const tbody = document.querySelector("tbody[data-controller='cart']");
          tbody.innerHTML = `<tr><td colspan="5" class="text-center">Your cart is empty</td></tr>`;
        }
      }
    })
    .catch(err => console.error("Error removing item:", err));
  }
});
</script>

<style>
.primary-btn {
  display: block;
  width: 100%;
  text-align: center;
  color: #fff;
  padding: 12px;
  border-radius: 5px;
  font-weight: bold;
  text-decoration: none;
  transition: 0.3s;
}

.primary-btn:hover {
  background: #e23030ff;
}

</style>
